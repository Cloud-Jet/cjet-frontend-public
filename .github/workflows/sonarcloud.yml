name: SonarCloud Analysis - Frontend
on:
  push:
    branches: 
      - main
      - develop
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  sonarcloud:
    name: SonarCloud Analysis
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Shallow clones should be disabled for better analysis

      - name: SonarCloud Scan
        uses: SonarSource/sonarqube-scan-action@v3
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

      - name: Slack Success Notification
        if: success()
        uses: 8398a7/action-slack@v3
        with:
          status: success
          channel: '#ci-cd-alerts'
          webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
          text: |
            ✅ **Frontend 코드 품질 검사 성공!**
            Repository: ${{ github.repository }}
            Branch: ${{ github.ref_name }}
            Commit: ${{ github.sha }}
            SonarCloud: https://sonarcloud.io/project/overview?id=Cloud-Jet_cjet-frontend-public

      - name: Slack Failure Notification  
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: failure
          channel: '#ci-cd-alerts'
          webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
          text: |
            ❌ **Frontend 코드 품질 검사 실패!**
            Repository: ${{ github.repository }}
            Branch: ${{ github.ref_name }}
            Commit: ${{ github.sha }}
            확인 필요: https://github.com/${{ github.repository }}/actions